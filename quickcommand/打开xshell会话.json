{"program":"quickcommand","cmd":"class XshellSessionManager {\r\n    constructor() {\r\n        this.XshellPathKey = \"xshell_path\";\r\n        this.XsehllSessionPathKey = \"xshell_session_path\";\r\n        this.XsehllSessionPath = '';\r\n        this.XshellPath = '';\r\n        this.KEY = 'xshell_session';\r\n    }\r\n\r\n    run() {\r\n        this.confInit();\r\n    }\r\n\r\n\r\n    confInit() {\r\n        if (!this.getData(this.XshellPathKey) || !this.getData(this.XsehllSessionPathKey)) {\r\n            this.setConfig((values) => {\r\n                this.updateData(this.XshellPathKey, this.handlePath(values[0]))\r\n                this.updateData(this.XsehllSessionPathKey, this.handlePath(values[1]))\r\n                this.init()\r\n            })\r\n        } else {\r\n            this.init()\r\n        }\r\n    }\r\n\r\n    setConfig(func = null) {\r\n        quickcommand.showInputBox({\r\n            labels: [\"请输入Xshell.exe路径\", \"请输入Xsehll Sessions路径\",],\r\n            values: [this.getData(this.XshellPathKey), this.getData(this.XsehllSessionPathKey)],\r\n            hints: [\"一般是安装路径/Xshell.exe\", \"一般是 C:/Users/{USERNAME}/Documents/NetSarang Computer/7/Xshell/Sessions\"]\r\n        }).then(values => {\r\n            if (func) {\r\n                func(values)\r\n            }\r\n        })\r\n    }\r\n\r\n    getData(key) {\r\n        return quickcommand.userData.get(key);\r\n    }\r\n\r\n    updateData(key, data) {\r\n        quickcommand.userData.put(data, key)\r\n    }\r\n\r\n    getAllSessions(path) {\r\n        path = path.replace(/\\\\/g, '/');\r\n        const SkipList = ['.', '..', 'default', 'Links', 'folder.ini'];\r\n        const pathList = fs.readdirSync(path);\r\n        const result = [];\r\n        const dirResult = [];\r\n        for (let i = 0; i < pathList.length; i++) {\r\n            const stat = fs.statSync(`${path}/${pathList[i]}`);\r\n            if (SkipList.includes(pathList[i])) {\r\n                continue;\r\n            }\r\n            if (stat.isDirectory()) {\r\n                dirResult.push(...this.getAllSessions(`${path}/${pathList[i]}`));\r\n            } else {\r\n                result.push(`${path}/${pathList[i]}`);\r\n            }\r\n        }\r\n        return dirResult.concat(result);\r\n    }\r\n\r\n    sessionFormat(list, path) {\r\n        path = path.replace(/\\\\/g, '/');\r\n        const result = [];\r\n        for (let i = 0; i < list.length; i++) {\r\n            const session = {\r\n                name: list[i].replace(path + '/', '').replace('.xsh', ''),\r\n                path: list[i]\r\n            }\r\n            result.push(session);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    openSession(path) {\r\n        const {exec} = require('child_process');\r\n        exec(`\"${this.XshellPath}\" \"${path}\"`, (err, stdout, stderr) => {\r\n            if (err) {\r\n                console.error(err);\r\n            }\r\n        });\r\n    }\r\n\r\n    updateDb($path) {\r\n        const list = this.getData(this.KEY);\r\n        const index = list.findIndex(item => item.path === $path);\r\n        list[index].time = new Date().getTime();\r\n        this.updateData(this.KEY, list);\r\n    }\r\n\r\n    renderList(list) {\r\n        const key = this.KEY;\r\n        const oldList = this.getData(key)\r\n        if (!oldList) {\r\n            list.forEach(item => {\r\n                item.time = 0;\r\n            });\r\n            this.updateData(key, list);\r\n            return list;\r\n        }\r\n        const newList = [];\r\n        list.forEach(item => {\r\n            const index = oldList.findIndex(oldItem => oldItem.path === item.path);\r\n            if (index === -1) {\r\n                item.time = 0;\r\n                newList.push(item);\r\n            } else {\r\n                newList.push(oldList[index]);\r\n            }\r\n        });\r\n        this.updateData(key, newList)\r\n        return newList.sort((a, b) => b.time - a.time);\r\n    }\r\n\r\n    init() {\r\n        this.XshellPath = this.getData(this.XshellPathKey);\r\n        this.XsehllSessionPath = this.getData(this.XsehllSessionPathKey);\r\n        const list = this.renderList(this.sessionFormat(this.getAllSessions(this.XsehllSessionPath), this.XsehllSessionPath));\r\n        const opt = []\r\n        for (let i = 0; i < list.length; i++) {\r\n            opt.push({title: list[i].name, description: list[i].path, path: list[i].path})\r\n        }\r\n        opt.push({title: '配置', description: '配置Xshell路径和Sessions路径', path: 'config'})\r\n        // 增加一个初始化按钮\r\n        opt.push({title: '初始化', description: '删除历史记录，重新扫描Sessions', path: 'init'})\r\n        quickcommand.showSelectList(opt, {optionType: 'json'}).then(choise => {\r\n            if (choise.path === 'config') {\r\n                this.setConfig((values) => {\r\n                    this.updateData(this.XshellPathKey, this.handlePath(values[0]))\r\n                    this.updateData(this.XsehllSessionPathKey, this.handlePath(values[1]))\r\n                    this.init()\r\n                })\r\n                return;\r\n            }\r\n            if (choise.path === 'init') {\r\n                quickcommand.userData.del(this.KEY)\r\n                utools.outPlugin()\r\n                return;\r\n            }\r\n            this.updateDb(choise.path)\r\n            this.openSession(choise.path)\r\n            utools.hideMainWindow()\r\n            utools.outPlugin()\r\n        })\r\n    }\r\n\r\n    handlePath(path) {\r\n        return path.replace(/\\\\/g, '/');\r\n    }\r\n}\r\n\r\nconst manager = new XshellSessionManager();\r\nmanager.run();","scptarg":"","charset":{"scriptCode":"","outputCode":""},"customOptions":{"bin":"","argv":"","ext":""},"features":{"explain":"打开xshell会话","platform":["win32","linux","darwin"],"icon":"data:image/png;base64,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","mainPush":false,"code":"key_tr3vc7k6j5","cmds":["Xshell会话"]},"output":"html","tags":["实用工具"],"hasSubInput":false}